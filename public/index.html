<!DOCTYPE html>
<html lang="en">

<head>

  <title>5-Day Weather Forecast</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">

  <link rel="stylesheet" href="styles.css">

  <div class="head-container">
    <h1>5-Day Weather Forecast</h1>

    <div id="search-history">
      <h2>Search History</h2>
      <ul id="history-list"></ul>
    </div>
  </div>
  <div class="search">
    <form id="search-form">
      <label for="city">Enter City:</label>
      <input type="text" id="city" placeholder="City" aria-label="Enter City">
      <button type="button" id="current-weather-btn">Current Weather</button>
      <button type="button" id="forecast-btn">5-Day Forecast</button>
    </form>
</head>

<body>

  <div id="current-weather" class="weather-container">
    <div id="current-weather-card" class="forecast-card">
      <div class="day"></div>
      <div class="datetime"></div>
      <div class="weather-details">
        <div class="temperature"></div>
        <div class="condition"></div>
        <div class="wind-speed"></div>
        <div class="humidity"></div>
        <i class="wi weather-icon"></i>
      </div>
      <div class="weather-video-container">
        <video loop muted autoplay>
          <!-- Weather video will be updated here -->
        </video>
      </div>
    </div>
    <!-- Current weather info will be updated here -->
  </div>
  <div class="weather-video-container">
    <video id="weather-video" loop muted autoplay>
      <!-- Weather video will be updated here -->
      <!-- Inside the forecast card template -->
      <video loop muted autoplay>
        <!-- Source for snowy weather -->
        <source src="videos/snowy.mp4" type="video/mp4">
        <!-- Source for cloudy weather -->
        <source src="videos/cloudy.mp4" type="video/mp4">
        <!-- Source for scattered showers -->
        <source src="videos/scattered showers.mp4" type="video/mp4">
        <!-- Source for heavy wind, rain, floodWatch -->
        <source src="videos/heavy wind,rain,floodwatch.mp4" type="video/mp4">
        <!-- Source for light rain -->
        <source src="videos/light rain.mp4" type="video/mp4">
        <!-- Source for bright and sunny weather -->
        <source src="videos/brightandsunny.mp4" type="video/mp4">
        <!-- Source for foggy weather -->
        <source src="videos/foggy.mp4" type="video/mp4">
        <!-- Source for tornado watch -->
        <source src="videos/tornado.mp4" type="video/mp4">
        <!-- Default source if no match found -->
        <source src="videos/brightandsunny.mp4" type="video/mp4">
      </video>
  </div>
  </div>
  <!-- Add a container for the 5 forecast index cards -->
  <div id="forecast" class="forecast-cards">
    <div id="forecast-cards"></div>

    <!-- 5-day forecast cards will be updated here -->
    <!-- Example card structure -->
    <!-- <div class="forecast-card">
              <div class="day">Monday</div>
              <div class="temperature">72°F</div>
              <div class="condition">Partly Cloudy</div>
              <div class="wind-speed">5 mph</div>
              <div class="humidity">40%</div>
              <i class="wi wi-day-cloudy"></i>
          </div> -->
  </div>
  </div>
  <script src="script.js"></script>
</body>

</html>

<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: nowrap;
    align-items: center;
    background: url('https://images.unsplash.com/photo-1499346030926-9a72daac6c63?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
    background-size: cover;
    /* Ensure the background image covers the entire viewport */
    background-attachment: fixed;
    /* Fix the background image to prevent scrolling */
  }

  .header-container {
    text-align: center;
    color: black;
    margin-top: 20px;
  }

  h1 {
    color: blue;
    font-size: auto;
    display: flex;
    place-self: start end;
    align-self: center;
  }

  .search-form {
    margin-bottom: 20px;
  }

  #search-history {
    margin-top: 20px;
  }

  #history-list {
    list-style: none;
    padding: 0;
  }

  #history-list li {
    margin-bottom: 5px;
    cursor: pointer;
    text-decoration: underline;
  }

  .weather-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    align-items: flex-end;
    height: 100%;
    padding: 20px;
    box-sizing: border-box;
  }

  .day {
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
    z-index: 1;
    color: blue
  }

  /* Styles for 5 day forecast */
  .forecast-container {
  display: flex; /* or grid */
  flex-wrap: wrap;
  justify-content: space-between; /* or other flexbox/grid properties */
}


  .forecast-card {
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    position: relative;
    width: 250px;
    height: 450px;
    margin: 20px;
    padding: 20px;
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
    overflow: hidden;
  }

  .weather-details {
    position: absolute;
    bottom: 0;
    left: 0;
    padding: 20px;
    background: rgba(0, 0, 0, 0.5);
    /* Transparent background */
    color: whitesmoke;
    width: 100%;
    /* Take full width of the card */
    box-sizing: border-box;
  }

  .forecast-card:hover {
    transform: scale(1.1);
  }


  .forecast-card video {
    position: relative;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  wi {
    /* Add necessary styles to display the icon */
    font-family: "Weather Icons";
    font-style: normal;
    font-weight: normal;
    line-height: 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
</style>

<!-- Add javascript-->
<!-- <script> -->
  document.addEventListener('DOMContentLoaded', function () {
    const currentWeatherApiKey = '55da60099dd1b8e7378a0a5da0283fba';
    const currentWeatherBaseUrl = 'https://api.openweathermap.org/data/2.5/weather';
    const forecastApiKey = '044dc32dae5bad14fd2034fe6bb5047a';
    const forecastBaseUrl = 'https://api.openweathermap.org/data/2.5/forecast';

    // Function to get weather videos based on weather conditions
    function updateWeatherVideo(weatherCondition) {
      const videoPath = "videos.js/";
      const videoMap = {
        "snowy": "snowy.mp4",
        "cloudy": "cloudy.mp4",
        "rain": "scattered showers.mp4",
        "heavyWind,rain,floodWatch": "heavy wind,rain,floodwatch.mp4",
        "scatteredShowers": "scattered showers.mp4",
        "lightRain": "light rain.mp4",
        "brightandsunny": "brightandsunny.mp4",
        "foggy": "foggy.mp4",
        "tornadoWatch": "tornado.mp4"
      };
      const videoFileName = videoMap[weatherCondition.toLowerCase()] || "default.mp4";
      return `${videoPath}${videoFileName}`;
    }

    // Function to fetch current weather data
    function fetchCurrentWeather(city) {
      fetch(`${currentWeatherBaseUrl}?q=${city}&appid=${currentWeatherApiKey}&units=imperial`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch current weather data');
          }
          return response.json();
        })
        .then(data => {
          console.log(data);
          updateCurrentWeatherInfo(data);
          updateWeatherVideo(data.weather[0].main.toLowerCase());
          return fetch(`${forecastBaseUrl}?q=${city}&appid=${forecastApiKey}&units=imperial`);
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch forecast data');
          }
          return response.json();
        })
        .then(data => {
          console.log(data);
          updateCurrentWeather(data);
        })
        .catch(error => console.error('Error fetching current data:', error.message));
    }

    // Event listener for search button click for current weather
    const currentWeatherBtn = document.getElementById('current-weather-btn');
    currentWeatherBtn.addEventListener('click', function () {
      const cityInput = document.getElementById('city');
      const city = cityInput.value;
      if (city) {
        fetchCurrentWeather(city);
      } else {
        alert('Please enter a city name.');
      }
    });

    // Function to update current weather info
    function updateCurrentWeatherInfo(data) {
      const currentWeatherElement = document.getElementById('current-weather');
      const currentDate = new Date(data.dt * 1000);
      currentWeatherElement.innerHTML = `
        <div class="day">${currentDate.toLocaleDateString('en-US', { weekday: 'long' })}</div>
        <div class="datetime">${currentDate.toLocaleString()}</div>
        <div class="weather-info">
        <div class="temperature">${data.main.temp}°F</div>
        <div class="condition">${data.weather[0].description}</div>
        <div class="wind-speed">${data.wind.speed} km/h Wind</div>
        <div class="humidity">${data.main.humidity}% Humidity</div>
        <i class="wi wi-${data.weather[0].icon}"></i>

        <div class="weather-video-container">
          <video loop muted autoplay>
            <source src="${updateWeatherVideo(data.weather[0].main.toLowerCase())}" type="video/mp4'>
          </video>
        </div>       
        `;
      // Update the weather icon class
      const weatherIconElement = currentWeatherElement.querySelector('.wi.weather-icon');
      weatherIconElement.className = `wi wi-${data.weather[0].icon}`;
    }


    // Function to handle search history
    function handleSearchHistory(city) {
      let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
      if (!searchHistory.includes(city)) {
        searchHistory.push(city);
        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        // Update the search history UI if needed
      }
    }
    // Function to fetch 5-day forecast data
    function fetchForecast(city) {
      fetch(`${forecastBaseUrl}?q=${city}&appid=${forecastApiKey}&units=metric`)
        .then(response => response.json())
        .then(data => {
          console.log(data);
          updateForecast(data);
        })
        .catch(error => console.error('Error fetching forecast data:', error));
    }

    // Event listener for the "5-Day Forecast" button
    const forecastBtn = document.getElementById('forecast-btn');
    forecastBtn.addEventListener('click', function () {
      const cityInput = document.getElementById('city');
      const city = cityInput.value.trim();
      if (city) {
        fetchForecast(city);
      } else {
        alert('Please enter a city name.');
      }
    });

    // Function to update the 5-day forecast index cards
    function updateForecast(data) {
      const forecastElement = document.getElementById('forecast-cards');
      if (!forecastElement) {
        console.error('Forecast element not found in the DOM.');
        return; // Exit the function if forecast element is not found
      }
      if (!data || !data.list || !Array.isArray(data.list)) {
        console.error('Invalid forecast data:', data);
        return; // Exit the function if forecast data is invalid or missing
      }

      forecastElement.innerHTML = ''; // Clear previous forecast data
      let cardCounter = 0; // Counter to limit cards to five
      for (let i = 0; i < data.list.length; i++) {
        const forecast = data.list[i];
        const forecastCard = document.createElement('div');
        forecastCard.classList.add('forecast-card');
        const forecastDate = new Date(forecast.dt_txt); // Use the forecast date/time
        const temperature = data.main ? `${data.main.temp}°F` : 'N/A'; // Check if data.main is defined
        const weatherDescription = forecast.weather && forecast.weather.length > 0 ? forecast.weather[0].description : 'N/A'; // Check if forecast.weather is defined and contains elements
    const windSpeed = forecast.wind ? `${forecast.wind.speed} km/h Wind` : 'N/A'; // Check if forecast.wind is defined
    const humidity = forecast.main ? `${forecast.main.humidity}% Humidity` : 'N/A'; // Check if forecast.main is defined
    const weatherIcon = forecast.weather && forecast.weather.length > 0 ? forecast.weather[0].icon : ''; // Check if forecast.weather is defined and contains elements
        forecastCard.innerHTML = `
        <div class="day">${forecastDate.toLocaleDateString('en-US', { weekday: 'long' })}</div>
      <div class="temperature">${temperature}</div>
      <div class="condition">${forecast.weather[0].description}</div>
      <div class="wind-speed">${forecast.wind.speed} km/h Wind</div>
      <div class="humidity">${forecast.main ? forecast.main.humidity : 'N/A'}% Humidity</div>
      <i class="wi wi-${forecast.weather[0].icon}"></i>
      <div class="weather-video-container">  
        <video loop muted autoplay>
    <source src="${updateWeatherVideo(data.weather[0].main.toLowerCase())}">
  </video>
</div>       
`;
forecastElement.appendChild(forecastCard);
    cardCounter++;
    if (cardCounter >= 5) {
      break; // Limit to five forecast cards
    }
  }
}
  })
      // </script>